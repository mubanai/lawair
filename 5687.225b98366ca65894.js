"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5687],{5687:(X,f,l)=>{l.r(f),l.d(f,{Tab3PageModule:()=>B});var g=l(4742),u=l(177),h=l(4341),C=l(1307),v=l(5593),P=l(467);class b{constructor(a,o,t,s,i,r,c){this._id=a,this.username=o,this.password=t,this.firstName=s,this.lastName=i,this.createdAt=r,this.updatedAt=c}}var e=l(4020),O=l(3656),T=l(1626),_=l(529);let I=(()=>{var n;class a{constructor(t,s){this.http=t,this.configService=s}generateSessionId(){var t;return console.log("===>"),this.http.post(`${null===(t=this.configService.config())||void 0===t?void 0:t.apiUrl}/start_session`,{})}getConversationMessages(t){var s;const i={participants:t};return this.http.post(`${null===(s=this.configService.config())||void 0===s?void 0:s.apiUrl}/api/v1/messages/getConversationMessages`,i)}sendMessage(t){var s;const i={...t};return this.http.post(`${null===(s=this.configService.config())||void 0===s?void 0:s.apiUrl}/rag-chat`,i)}uploadFileIndex(t){return this.http.post("localhost:5000/pass",t)}}return(n=a).\u0275fac=function(t){return new(t||n)(e.KVO(T.Qq),e.KVO(_.d))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),a})();const S=["content"],w=["chatInput"];function x(n,a){1&n&&(e.j41(0,"div"),e.EFF(1," pending "),e.nrm(2,"ion-icon",21),e.k0s())}function k(n,a){1&n&&(e.j41(0,"div"),e.EFF(1," sent "),e.nrm(2,"ion-icon",22),e.k0s())}function y(n,a){if(1&n&&e.DNE(0,k,3,0,"div",20),2&n){e.XpG();const o=e.sdS(5),t=e.XpG().$implicit;e.Y8G("ngIf","sent"===t.status)("ngIfElse",o)}}function F(n,a){1&n&&(e.j41(0,"div"),e.EFF(1," seen "),e.nrm(2,"ion-icon",23),e.k0s())}function $(n,a){if(1&n&&e.DNE(0,F,3,0,"div",13),2&n){const o=e.XpG(2).$implicit;e.Y8G("ngIf","seen"===o.status)}}function N(n,a){if(1&n&&(e.j41(0,"div",19),e.DNE(1,x,3,0,"div",20)(2,y,1,2,"ng-template",null,2,e.C5r)(4,$,1,1,"ng-template",null,3,e.C5r),e.k0s()),2&n){const o=e.sdS(3),t=e.XpG().$implicit;e.R7$(),e.Y8G("ngIf","pending"===t.status)("ngIfElse",o)}}function G(n,a){if(1&n&&(e.j41(0,"div",14)(1,"div",15)(2,"div",16)(3,"p"),e.EFF(4),e.k0s()(),e.j41(5,"div",17)(6,"p"),e.EFF(7),e.k0s()()(),e.DNE(8,N,6,2,"div",18),e.k0s()),2&n){const o=a.$implicit;e.AVh("right",!0===o.userIsSender),e.R7$(4),e.SpI(" ",o.senderFullName,""),e.R7$(3),e.JRh(o.message),e.R7$(),e.Y8G("ngIf",o.userIsSender)}}function E(n,a){if(1&n){const o=e.RV6();e.j41(0,"ion-button",24),e.bIt("click",function(){e.eBV(o);const s=e.XpG();return e.Njj(s.sendMessage())}),e.nrm(1,"ion-icon",25),e.k0s()}}function R(n,a){1&n&&e.nrm(0,"ion-spinner")}const j=[{path:"",component:(()=>{var n;class a{constructor(t,s,i,r,c){this.navCtrl=t,this.conversationMessagesService=s,this.activatedRoute=i,this.loadingController=r,this.appService=c,this.messages=[],this.conversationId="",this.receiverFullName="",this.isCalled=!1,this.listenToSocketUpdateListMessagesEvent()}ngOnInit(){var t=this;return(0,P.A)(function*(){yield(yield t.loadingController.create({spinner:"bubbles",cssClass:"custom-loader-class",showBackdrop:!1})).present(),yield t.loadingController.dismiss(),t.getConversationMessages(),t.conversationMessagesService.generateSessionId().subscribe(i=>{i.session_id&&t.appService.setSessionId(i.session_id)},i=>{console.log("caught error {}",i),t.isCalled=!1})})()}onFocus(){this.messageInput&&this.messageInput.nativeElement&&this.messageInput.nativeElement.focus()}getConversationMessages(t){const s=this.appService.getUserObj(),i=new b;i._id="2",i.username="driod@gmail.com",i.firstName="LawAir",i.lastName="",i.password="driod@gmail.com";const r=s;r._id="1";const d=i;(this.receiverFullName=d.firstName+" "+d.lastName,console.log("-----\x3e"),this.receiverId=d._id,r)&&(t&&("string"==typeof r?this.conversationId=r:(this.pushNewMessage({message:t.response,sender:d,session_id:"710ec67d-4ee1-4179-a97a-02022210fde4",receivers:[{receiverId:this.receiverId,isRead:!0}],receiversIds:[this.receiverId],userIsSender:!1,createdAt:new Date}),this.messages=this.messages.map(D=>this.filterMessageAndUpdateStatus(D,r)),this.scrollToBottom())))}filterMessageAndUpdateStatus(t,s){var i,r,c,d,m,p;return t.senderFullName=null!==(i=null!==(r=null===(c=t.sender)||void 0===c?void 0:c.firstName)&&void 0!==r?r:" "+(null===(d=t.sender)||void 0===d?void 0:d.lastName))&&void 0!==i?i:"",(null===(m=t.sender)||void 0===m?void 0:m._id)===(null==s?void 0:s.id)&&(t.userIsSender=!0),null===(p=t.receivers)||void 0===p||p.forEach(M=>{t.userIsSender&&(t.status=M.isRead?"seen":"sent")}),t}sendMessage(){var t,s;if(null===(t=this.editorMsg)||void 0===t||!t.trim())return;this.isCalled=!0;const i={message:this.editorMsg,session_id:null!==(s=this.appService.getSessionId())&&void 0!==s?s:"",db_folder:"health_supplements",receiversIds:[this.receiverId],userIsSender:!0,createdAt:new Date};this.editorMsg="",this.onFocus(),this.pushNewMessage(i),this.conversationMessagesService.sendMessage(i).subscribe(r=>{this.isCalled=!1,this.messages.forEach(c=>{c.message===i.message&&c.userIsSender&&(c.status="sent")}),this.getConversationMessages(r)},r=>{console.log("caught error {}",r),this.isCalled=!1})}listenToSocketUpdateListMessagesEvent(){this.getConversationMessages(),this.scrollToBottom()}scrollToBottom(){setTimeout(()=>{this.content.scrollToBottom&&this.content.scrollToBottom()},200)}pushNewMessage(t){t.status="pending",this.messages.push(t),this.scrollToBottom()}ngOnDestroy(){console.log("Getting destroyed the message component!!!")}}return(n=a).\u0275fac=function(t){return new(t||n)(e.rXU(O.q9),e.rXU(I),e.rXU(v.nX),e.rXU(g.Xi),e.rXU(_.d))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-tab3"]],viewQuery:function(t,s){if(1&t&&(e.GBs(S,7),e.GBs(w,7)),2&t){let i;e.mGM(i=e.lsd())&&(s.content=i.first),e.mGM(i=e.lsd())&&(s.messageInput=i.first)}},standalone:!1,decls:15,vars:5,consts:[["content",""],["chatInput",""],["sent",""],["seen",""],[3,"translucent"],[1,"three-d-title"],["id","content",1,"ion-padding"],[1,"message-wrap"],["class","message",3,"right",4,"ngFor","ngForOf"],["id","bottom"],["lines","none"],["clearInput","true","placeholder","Type something here",3,"ngModelChange","focusin","ngModel"],["size","large","slot","end","fill","outline",3,"click",4,"ngIf"],[4,"ngIf"],[1,"message"],[1,"msg-detail"],[1,"msg-info"],[1,"msg-content"],["class","msg-status",4,"ngIf"],[1,"msg-status"],[4,"ngIf","ngIfElse"],["name","checkmark-circle"],["name","checkmark-circle-outline"],["name","checkmark"],["size","large","slot","end","fill","outline",3,"click"],["name","send-outline","slot","icon-only"]],template:function(t,s){if(1&t){const i=e.RV6();e.j41(0,"ion-header",4)(1,"ion-toolbar")(2,"ion-title",5),e.EFF(3," LawAIr, Your Legal Advisor "),e.k0s()()(),e.j41(4,"ion-content",6,0)(6,"div",7),e.DNE(7,G,9,5,"div",8),e.k0s(),e.nrm(8,"div",9),e.k0s(),e.j41(9,"ion-footer")(10,"ion-item",10)(11,"ion-textarea",11,1),e.mxI("ngModelChange",function(c){return e.eBV(i),e.DH7(s.editorMsg,c)||(s.editorMsg=c),e.Njj(c)}),e.bIt("focusin",function(){return e.eBV(i),e.Njj(s.onFocus())}),e.k0s(),e.DNE(13,E,2,0,"ion-button",12)(14,R,1,0,"ion-spinner",13),e.k0s()()}2&t&&(e.Y8G("translucent",!0),e.R7$(7),e.Y8G("ngForOf",s.messages),e.R7$(4),e.R50("ngModel",s.editorMsg),e.R7$(2),e.Y8G("ngIf",!1===s.isCalled),e.R7$(),e.Y8G("ngIf",!0===s.isCalled))},dependencies:[g.Jm,g.W9,g.M0,g.eU,g.iq,g.uz,g.w2,g.nc,g.BC,g.ai,g.Gw,u.Sq,u.bT,h.BC,h.vS],styles:[".three-d-title[_ngcontent-%COMP%]{font-size:18px;color:#333;line-height:1.6;font-weight:500;padding:15px;background:#0000000d;border-left:4px solid black;border-right:4px solid black;box-shadow:inset 3px 3px 5px #0000001a;transition:all .3s ease}ion-content[_ngcontent-%COMP%]   .scroll-content[_ngcontent-%COMP%]{background-color:#f5f5f5}ion-footer[_ngcontent-%COMP%]   .send-button[_ngcontent-%COMP%]{position:relative;--padding-end: 0;--padding-start: 0;--background-activated: rgba(0, 0, 0, 0);--background-focused: rgba(0, 0, 0, 0);--background-hover: rgba(0, 0, 0, 0)}ion-footer[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--ion-color-custom)}.header[_ngcontent-%COMP%]{height:45%;background:var(--ion-color-primary)}ion-card[_ngcontent-%COMP%]{bottom:50px;width:80%;height:40%;--background: white;left:7.5%}.sign-up[_ngcontent-%COMP%]{color:var(--ion-color-medium);position:relative}.sign-up[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]{color:#d42d0f}.message-wrap[_ngcontent-%COMP%]{padding:0 10px}.message-wrap[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{min-height:100%;position:relative;padding:7px 0}.message-wrap[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .msg-detail[_ngcontent-%COMP%]{width:100%;display:inline-block}.message-wrap[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .msg-detail[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0}.message-wrap[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .msg-detail[_ngcontent-%COMP%]   .msg-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-transform:capitalize;font-size:.8em;color:#888}.message-wrap[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .msg-detail[_ngcontent-%COMP%]   .msg-content[_ngcontent-%COMP%]{white-space:pre-wrap;position:relative;float:left;margin-top:2px;border-radius:10px;padding:10px;border:2px solid #ddd;width:auto;max-width:70%;background-color:#fff}.message-wrap[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .msg-status[_ngcontent-%COMP%]{text-transform:capitalize;font-size:.8em;font-weight:700;color:#888;padding-left:1%}.message-wrap[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]   .msg-status[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{position:relative;top:3px;font-size:15px}.message-wrap[_ngcontent-%COMP%]   .message.right[_ngcontent-%COMP%]{min-height:100%;position:relative;padding:7px 0}.message-wrap[_ngcontent-%COMP%]   .message.right[_ngcontent-%COMP%]   .msg-detail[_ngcontent-%COMP%]{width:100%;display:inline-block}.message-wrap[_ngcontent-%COMP%]   .message.right[_ngcontent-%COMP%]   .msg-detail[_ngcontent-%COMP%]   .msg-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:right;text-transform:capitalize;font-size:.8em;color:#888}.message-wrap[_ngcontent-%COMP%]   .message.right[_ngcontent-%COMP%]   .msg-detail[_ngcontent-%COMP%]   .msg-content[_ngcontent-%COMP%]{white-space:pre-wrap;color:#000;background-color:var(--ion-color-custom);float:right;position:relative;margin-top:2px;border-radius:10px;padding:10px;width:auto;max-width:70%}.message-wrap[_ngcontent-%COMP%]   .message.right[_ngcontent-%COMP%]   .msg-status[_ngcontent-%COMP%]{text-align:right;text-transform:capitalize;font-size:.8em;font-weight:700;color:#888;padding-right:1%}"]}),a})()}];let U=(()=>{var n;class a{}return(n=a).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[v.iI.forChild(j),v.iI]}),a})(),B=(()=>{var n;class a{}return(n=a).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[g.bv,u.MD,h.YN,C.S,U]}),a})()}}]);